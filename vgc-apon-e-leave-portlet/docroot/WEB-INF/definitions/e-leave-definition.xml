<?xml version="1.0" encoding="UTF-8"?>
<workflow-definition xmlns="urn:liferay.com:liferay-workflow_6.2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:liferay.com:liferay-workflow_6.2.0 http://www.liferay.com/dtd/liferay-workflow-definition_6_2_0.xsd">
    <name>E Leave</name>
    <description>E Leave workflow process action.</description>
    <version>1</version>
    <state>
        <name>created</name>
        <metadata><![CDATA[{"transitions":{"Supervisor":{"bendpoints":[]},"review":{"bendpoints":[],"xy":[-19,4]}},"xy":[100,50]}]]></metadata>
        <initial>true</initial>
        <transitions>
            <transition>
                <name>review</name>
                <target>Supervisor</target>
                <default>true</default>
            </transition>
        </transitions>
    </state>
    <state>
        <name>approved</name>
        <metadata><![CDATA[{"terminal":true,"xy":[580,50]}]]></metadata>
        <actions>
            <action>
                <name>approve</name>
                <script><![CDATA[
				import com.liferay.portal.kernel.workflow.WorkflowStatusManagerUtil;
				import com.liferay.portal.kernel.workflow.WorkflowConstants;
				WorkflowStatusManagerUtil.updateStatus(WorkflowConstants.toStatus("approved"), workflowContext);

				]]></script>
                <script-language>groovy</script-language>
                <execution-type>onEntry</execution-type>
            </action>
        </actions>
    </state>
    <task>
        <name>Supervisor</name>
        <metadata><![CDATA[{"transitions":{"update":{"bendpoints":[]},"approve":{"bendpoints":[],"xy":[-24,4]},"reject":{"bendpoints":[[315,212]]}},"xy":[250,35]}]]></metadata>
        <actions>
            <action>
                <name>resubmit</name>
                <script><![CDATA[
					import com.liferay.portal.kernel.workflow.WorkflowStatusManagerUtil;
									import com.liferay.portal.kernel.workflow.WorkflowConstants;
									WorkflowStatusManagerUtil.updateStatus(WorkflowConstants.toStatus("pending"), workflowContext);
				]]></script>
                <script-language>groovy</script-language>
                <execution-type>onEntry</execution-type>
            </action>
        </actions>
        <assignments>
            <scripted-assignment>
                <script><![CDATA[
				import com.liferay.portal.service.UserLocalServiceUtil;
				import com.liferay.portal.kernel.util.GetterUtil;
				import com.liferay.portal.kernel.workflow.WorkflowConstants;
				import com.liferay.portal.service.ServiceContext;
				import com.liferay.portal.service.RoleLocalServiceUtil;
				import com.liferay.portal.model.Role;
				
				long companyId = GetterUtil.getLong((String) workflowContext.get(WorkflowConstants.CONTEXT_COMPANY_ID));
				ServiceContext serviceContext = (ServiceContext) workflowContext.get(WorkflowConstants.CONTEXT_SERVICE_CONTEXT);
				Role supervisorRole = (Role) serviceContext.getAttribute("vgcapon_e_leave_supervisor");
				user = null;
				roles = new ArrayList<Role>();
				roles.add(supervisorRole);
				]]></script>
                <script-language>groovy</script-language>
            </scripted-assignment>
        </assignments>
        <transitions>
            <transition>
                <name>approve</name>
                <target>Leave Coordinator</target>
            </transition>
            <transition>
                <name>reject</name>
                <target>update</target>
                <default>true</default>
            </transition>
        </transitions>
    </task>
    <task>
        <name>Leave Coordinator</name>
        <metadata><![CDATA[{"transitions":{"approve":{"bendpoints":[],"xy":[-24,3]},"approved":{"bendpoints":[]}},"xy":[410,35]}]]></metadata>
        <actions>
            <action>
                <name>approve</name>
                <script><![CDATA[
					import com.liferay.portal.kernel.workflow.WorkflowStatusManagerUtil;
									import com.liferay.portal.kernel.workflow.WorkflowConstants;
									WorkflowStatusManagerUtil.updateStatus(101, workflowContext);
				]]></script>
                <script-language>groovy</script-language>
                <execution-type>onEntry</execution-type>
            </action>
        </actions>
        <assignments>
            <scripted-assignment>
                <script><![CDATA[/*specify script assignment */

import com.liferay.portal.kernel.util.GetterUtil;
import com.liferay.portal.kernel.workflow.WorkflowConstants;
import com.liferay.portal.service.ServiceContext;
import com.liferay.portal.service.RoleLocalServiceUtil;
import com.liferay.portal.model.Role;

long companyId = GetterUtil.getLong((String) workflowContext.get(WorkflowConstants.CONTEXT_COMPANY_ID));
ServiceContext serviceContext = (ServiceContext) workflowContext.get(WorkflowConstants.CONTEXT_SERVICE_CONTEXT);
Role[] adminRoles = (Role[]) serviceContext.getAttribute("vgcapon_EL_Leave_Coordinator");
roles = new ArrayList<Role>();
for(Role role:adminRoles) {
	roles.add(role);
}
user = null;
]]></script>
                <script-language>groovy</script-language>
            </scripted-assignment>
        </assignments>
        <transitions>
            <transition>
                <name>approve</name>
                <target>approved</target>
                <default>true</default>
            </transition>
        </transitions>
    </task>
    <task>
        <name>update</name>
        <metadata><![CDATA[{"transitions":{"resubmit":{"bendpoints":[]}},"xy":[380,230]}]]></metadata>
        <actions>
            <action>
                <name>reject</name>
                <script><![CDATA[
					Packages.com.liferay.portal.kernel.workflow.WorkflowStatusManagerUtil.updateStatus(Packages.com.liferay.portal.kernel.workflow.WorkflowConstants.toStatus("draft"), workflowContext);
				]]></script>
                <script-language>javascript</script-language>
                <execution-type>onEntry</execution-type>
            </action>
        </actions>
        <assignments>
            <user></user>
        </assignments>
        <transitions>
            <transition>
                <name>resubmit</name>
                <target>Supervisor</target>
                <default>true</default>
            </transition>
        </transitions>
    </task>
</workflow-definition>